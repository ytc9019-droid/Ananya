<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Scientific Calculator (Single File)</title>
  <style>
    /* Inlined CSS for Scientific Calculator (copied from calculator.css) */
    :root{
      --bg: #0f1724; /* dark blue */
      --panel: #111827;
      --accent: linear-gradient(135deg, #f43f5e, #7c3aed);
      --glass: rgba(255,255,255,0.04);
      --muted: #9ca3af;
      --text: #e6eef8;
      --success: #22c55e;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
      background: radial-gradient(closest-side, #051021 0%, var(--bg) 45%);
      color:var(--text);
      display:flex;
      align-items:center;
      justify-content:center;
      padding:32px;
    }
    .calc-wrap{
      width: min(720px, 95vw);
      border-radius:12px;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.18));
      box-shadow: 0 4px 36px rgba(0,0,0,0.6), inset 0 1px 0 rgba(255,255,255,0.02);
      overflow:hidden;
      border: 1px solid rgba(255,255,255,0.04);
    }
    .calc-header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:18px 20px;
      gap:12px;
    }
    .calc-header h1{
      margin:0;
      font-size:18px;
      letter-spacing:0.6px;
      color:var(--text);
      font-weight:600;
    }
    .mode{display:flex;gap:8px;align-items:center;color:var(--muted)}
    .display{
      padding:16px 20px;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.02));
      border-top:1px solid rgba(255,255,255,0.02);
    }
    .expr{
      text-align:right;
      color:var(--muted);
      font-size:16px;
      min-height:20px;
    }
    .result{
      font-size:32px;
      text-align:right;
      margin-top:6px;
      font-weight:600;
    }
    .kbd{
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap:12px;
      padding:20px;
      background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(0,0,0,0));
    }
    .btn{
      border: none;
      border-radius:10px;
      padding:16px 14px;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      color:var(--text);
      font-weight:600;
      font-size:16px;
      cursor:pointer;
      box-shadow: 0 2px 8px rgba(0,0,0,0.4);
      transition: transform .12s ease, box-shadow .12s ease, filter .12s ease;
    }
    .btn:active{transform: translateY(1px) scale(0.995)}
    .btn:hover{filter:brightness(1.06)}
    .btn.op{background: linear-gradient(180deg, rgba(124,58,237,0.95), rgba(124,58,237,0.85)); color:white}
    .btn.equals{grid-column: 4 / 5; background: var(--accent); color:white; box-shadow: 0 8px 30px rgba(124,58,237,0.18)}
    .btn.wide{grid-column: span 2}
    .sc-row{grid-column: 1 / 5; display:flex; gap:12px;}
    .sc{flex:1; background: rgba(255,255,255,0.02); border: 1px solid rgba(255,255,255,0.03)}
    .credits{font-size:12px;padding:12px 20px;color:var(--muted)}
    /* Responsive */
    @media (max-width:560px){
      .kbd{grid-template-columns: repeat(3, 1fr)}
      .btn.equals{grid-column:auto}
      .btn.wide{grid-column: span 2}
    }
  </style>
</head>
<body>
  <main class="calc-wrap" role="application" aria-label="Scientific calculator">
    <header class="calc-header">
      <h1>Scientific Calculator</h1>
      <div class="mode">
        <label for="angle-toggle">Radians</label>
        <input id="angle-toggle" type="checkbox" aria-label="Angle mode: toggle to degrees">
        <label for="angle-toggle">Degrees</label>
      </div>
    </header>

    <section class="display" aria-live="polite">
      <div id="expr" class="expr">0</div>
      <div id="result" class="result"></div>
    </section>

    <section class="kbd" role="group" aria-label="calculator keypad">
      <button data-fn="clear" class="btn wide">AC</button>
      <button data-fn="delete" class="btn">⌫</button>
      <button data-val="(" class="btn">(</button>
      <button data-val=")" class="btn">)</button>

      <button data-fn="ans" class="btn">ANS</button>
      <button data-fn="pi" class="btn">π</button>
      <button data-fn="exp" class="btn">eˣ</button>
      <button data-val="/" class="btn op">÷</button>

      <button data-val="7" class="btn">7</button>
      <button data-val="8" class="btn">8</button>
      <button data-val="9" class="btn">9</button>
      <button data-val="*" class="btn op">×</button>

      <button data-val="4" class="btn">4</button>
      <button data-val="5" class="btn">5</button>
      <button data-val="6" class="btn">6</button>
      <button data-val="-" class="btn op">−</button>

      <button data-val="1" class="btn">1</button>
      <button data-val="2" class="btn">2</button>
      <button data-val="3" class="btn">3</button>
      <button data-val="+" class="btn op">+</button>

      <button data-val="0" class="btn wide">0</button>
      <button data-val="." class="btn">.</button>
      <button data-fn="ans-apply" class="btn" title="Insert previous answer">Ans</button>
      <button data-fn="equals" class="btn equals">=</button>

      <div class="sc-row">
        <button data-fn="sin" class="btn sc">sin</button>
        <button data-fn="cos" class="btn sc">cos</button>
        <button data-fn="tan" class="btn sc">tan</button>
        <button data-fn="sqrt" class="btn sc">√</button>
      </div>
      <div class="sc-row">
        <button data-fn="pow2" class="btn sc">x²</button>
        <button data-fn="pow" class="btn sc">^</button>
        <button data-fn="log" class="btn sc">log</button>
        <button data-fn="ln" class="btn sc">ln</button>
      </div>
      <div class="sc-row">
        <button data-fn="fact" class="btn sc">x!</button>
        <button data-fn="perm" class="btn sc">nPr</button>
        <button data-fn="comb" class="btn sc">nCr</button>
        <button data-fn="factoradic" class="btn sc">Factoradic</button>
      </div>

    </section>

    <footer class="credits">Built with &hearts; — keyboard controls supported: Enter / Backspace / Escape</footer>
  </main>
  <script>
    /* Inlined JS for Scientific Calculator (copied from calculator.js)
     * This script supports a simple, fairly safe expression parser by
     * replacing common function names with Math.<function> and then running Function(...)
     * This is not meant for untrusted content but is safe for local usage in a user page.
     */

    const exprEl = document.getElementById('expr');
    const resultEl = document.getElementById('result');
    const toggle = document.getElementById('angle-toggle');
    const keypad = document.querySelector('.kbd');

    let expression = '';
    let lastAnswer = '';
    let isDegree = false;

    // Helper math functions
    function fact(n){
      // factorial for non-negative integers
      if(typeof n !== 'number' || !Number.isFinite(n)) throw new Error('Factorial: number required');
      if(!Number.isInteger(n) || n < 0) throw new Error('Factorial: integer >= 0 required');
      if(n === 0 || n === 1) return 1;
      let res = 1;
      for(let i = 2; i <= n; i++) res *= i;
      return res;
    }

    function perm(n, r){
      if(!Number.isInteger(n) || !Number.isInteger(r) || n < 0 || r < 0 || r > n) throw new Error('nPr: invalid args');
      return fact(n) / fact(n - r);
    }

    function comb(n, r){
      if(!Number.isInteger(n) || !Number.isInteger(r) || n < 0 || r < 0 || r > n) throw new Error('nCr: invalid args');
      return fact(n) / (fact(r) * fact(n - r));
    }

    function factoradic(n){
      // Convert non-negative integer to factoradic representation (as string digits)
      if(!Number.isInteger(n) || n < 0) throw new Error('Factoradic: integer >= 0 required');
      if(n === 0) return '0';
      const digits = [];
      let i = 1;
      while(n > 0){
        digits.push(n % (i + 1));
        n = Math.floor(n / (i + 1));
        i++;
      }
      return digits.reverse().join('');
    }

    function updateDisplay(){
      exprEl.textContent = expression || '0';
    }

    function safeEval(input){
      // Replace unicode symbols
      let s = input.replace(/×/g, '*').replace(/÷/g, '/').replace(/−/g, '-');

      // Basic sanitization: allow digits, operators, parentheses, dot, exclamation and letters
      if(!/^[0-9+\-*/().,^%!\sA-Za-z]*$/.test(s)){
        throw new Error('Invalid characters in expression');
      }

      // function mappings to Math
      const tokens = {
          'sqrt': 'Math.sqrt',
          'log': 'Math.log10',
          'ln': 'Math.log',
          'pi': 'Math.PI',
          'e': 'Math.E'
      };

      // apply degree conversion wrapper if necessary (wrap sin/cos/tan)
      if(isDegree){
        s = s.replace(/(sin|cos|tan)\s*\(/g, (m, fn) => `Math.${fn}(Math.PI/180*`);
      } else {
        s = s.replace(/(sin|cos|tan)\s*\(/g, (m, fn) => `Math.${fn}(`);
      }

      // Replace named functions
      Object.keys(tokens).forEach(k=>{
        const re = new RegExp('\\b'+k+'\\b','g');
        s = s.replace(re, tokens[k]);
      });

      // Replace nCr / nPr typed by the user to our helper function names
      s = s.replace(/\bnCr\b/g, 'comb');
      s = s.replace(/\bnPr\b/g, 'perm');

      // exponent operator ^ -> Math.pow(a,b)
      // Convert a^b to Math.pow(a,b) using a simple parser for ^ (right associative)
        // Replace ^ with ** (JS exponent operator) so users can write x^y
        s = s.replace(/\^/g, '**');

      // e^x support: we have 'exp' named as e^x: replace "e^" occurrences
        s = s.replace(/e\s*\*\*\s*([0-9\.\(A-Za-zPI\-+])/g, 'Math.exp($1)');

      // replace percent:
      s = s.replace(/(\d+(?:\.\d+)?)%/g, '($1/100)');

      // Replace Ans with previous last answer
      s = s.replace(/\bANS\b/g, '('+ (lastAnswer||'0') +')');

      // Replace factorial postfix x! or (expr)! using a simple parser for most typical cases
      // Match a number (int/float) or a fully parenthesized expression right before '!'
      s = s.replace(/(\([^()]*\)|\d+(?:\.\d+)?)\s*!/g, 'fact($1)');

      // Finally use Function to evaluate and return
      // allow Math functions only
      try{
        // Provide our custom functions to the evaluation environment as well
        // This allows expressions like perm(5,2) or fact(5) or factoradic(10)
        const f = new Function('Math','fact','perm','comb','factoradic', 'return ('+s+');');
        return f(Math, fact, perm, comb, factoradic);
      }catch(e){
        throw new Error('Parse error');
      }
    }

    function press(val){
      expression = (expression === '0' || expression === '') ? String(val) : expression + String(val);
      updateDisplay();
    }

    function runFunc(name){
      switch(name){
        case 'clear': expression = ''; resultEl.textContent = ''; break;
        case 'delete': expression = expression.slice(0,-1); break;
        case 'equals':
          try{
            const res = safeEval(expression);
            resultEl.textContent = String(res);
            lastAnswer = String(res);
            expression = String(res);
          }catch(e){
            resultEl.textContent = e.message;
          }
          break;
        case 'ans': expression = String(lastAnswer||'0'); break;
        case 'ans-apply': expression = (expression || '0') + String(lastAnswer||'0'); break;
        case 'pi': expression += 'pi'; break;
        case 'exp': expression += 'e^'; break;
        case 'sin': expression += 'sin('; break;
        case 'cos': expression += 'cos('; break;
        case 'tan': expression += 'tan('; break;
        case 'sqrt': expression += 'sqrt('; break;
        case 'ln': expression += 'ln('; break;
        case 'log': expression += 'log('; break;
        case 'pow2': expression += '^2'; break;
        case 'pow': expression += '^'; break;
        case 'fact':
          // Append postfix factorial to last token for convenience
          if(/\d|\)$/.test(expression.slice(-1))){
            expression += '!';
          } else {
            // otherwise insert as a function name awaiting arguments
            expression += 'fact(';
          }
          break;
        case 'perm': expression += 'perm('; break;
        case 'comb': expression += 'comb('; break;
        case 'factoradic':
          // If there is a number expression already, evaluate and show factoradic directly
          if(expression && /\d|\)$/.test(expression.slice(-1))){
            try{
              const value = safeEval(expression);
              const f = factoradic(Number(value));
              resultEl.textContent = String(f);
              expression = String(f); // optionally replace expression with the factoradic string
            }catch(e){
              resultEl.textContent = e.message;
            }
          } else {
            expression += 'factoradic(';
          }
          break;
      }
      updateDisplay();
    }

    keypad.addEventListener('click', e=>{
      const btn = e.target.closest('button');
      if(!btn) return;
      const val = btn.getAttribute('data-val');
      const fn = btn.getAttribute('data-fn');
      if(val) press(val);
      if(fn) runFunc(fn);
    });

    // keyboard support
    window.addEventListener('keydown', e=>{
      if(e.key === 'Enter') { runFunc('equals'); e.preventDefault(); }
      if(e.key === 'Backspace') { runFunc('delete'); e.preventDefault(); }
      if(e.key === 'Escape') { runFunc('clear'); e.preventDefault(); }
      if('0123456789.+-*/%^()!'.includes(e.key)) { press(e.key); e.preventDefault(); }
    });

    // Angle toggle
    toggle.addEventListener('change', e=>{
      isDegree = toggle.checked; // checked = degrees
    });

    // Initialize
    updateDisplay();
  </script>
</body>
</html>
